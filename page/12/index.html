<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="red">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
    
  
  <link href="//cdn.jsdelivr.net/npm/fancybox@3.0.0/dist/css/jquery.fancybox.min.css" rel="stylesheet" type="text/css">




  
  
  
  

  

  

  

  

  

  
  
    

    
  

  
    
    
    <link href="//fonts.cat.net/css?family=Sigmar One:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.4.2" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.2">


  <link rel="mask-icon" href="/images/logo.svg?v=6.4.2" color="red">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    since: '11/11/2018 11:11:11',
    evanyou: true,
    root: '/',
    scheme: 'Pisces',
    version: '6.4.2',
    sidebar: {"position":"right","display":"post","offset":52,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":false}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  












  <meta name="description" content="我不知道将去何方，但我已在路上。">
<meta property="og:type" content="website">
<meta property="og:title" content="YonJim">
<meta property="og:url" content="http://yoursite.com/page/12/index.html">
<meta property="og:site_name" content="YonJim">
<meta property="og:description" content="我不知道将去何方，但我已在路上。">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="YonJim">
<meta name="twitter:description" content="我不知道将去何方，但我已在路上。">






  <link rel="canonical" href="http://yoursite.com/page/12/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>YonJim</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

<link rel="stylesheet" href="\assets\css\APlayer.min.css" class="aplayer-style-marker">
<script src="\assets\js\APlayer.min.js" class="aplayer-script-marker"></script>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-right 
  page-home">
  
    

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner">



  


<nav class="site-nav">
  
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
          
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
          
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
          
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
          
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
      
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>




<div class="site-brand-wrapper" style="background-image: url(/images/header.jpg)">
  <div class="site-meta ">
    

   
    <div class="custom-logo-site-title">
      <div class="brand">
        <span class="logo-line-before"><i></i></span>
        <div class="site-title">
          <div id="animate" class="animate">
            <span>Y</span><span>o</span><span>n</span><span>J</span><span>i</span><span>m</span>
          </div>
          <div id="guide" class="guide">
            <span>Y</span><span>o</span><span>n</span><span>J</span><span>i</span><span>m</span>
          </div>
        </div>
        <span class="logo-line-after"><i></i></span>
      </div>
    </div>
      
        <p class="site-subtitle">YonJim的个人博客</p>
      
  </div>

   
  
</div>


</div>
    </header>

     

   <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-date">
			<div class="post-month">12月</div>
			<div class="post-day">12</div>
	</div>
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/12/PHP/当初就不该学PHP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="YonJim">
      <meta itemprop="description" content="我不知道将去何方，但我已在路上。">
      <meta itemprop="image" content="/images/293854950580539874.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YonJim">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/12/PHP/当初就不该学PHP/" itemprop="url">
                  当初就不该学PHP
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-12 21:43:15" itemprop="dateCreated datePublished" datetime="2018-12-12T21:43:15+08:00">2018-12-12</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/php/" itemprop="url" rel="index"><span itemprop="name">php</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/12/12/PHP/当初就不该学PHP/" class="leancloud_visitors" data-flag-title="当初就不该学PHP">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>舍友推荐的一首歌，真的扎心了。这里附上他的<a href="http://www.huangzhongxin.cn/" target="_blank" rel="noopener">博客</a> 有兴趣的去逛一逛哈。</p>
<blockquote>
<p>当初就不该学php – 黄灰红 词 : 黄绿蓝 曲 : 黄绿蓝</p>
</blockquote>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=472112352&auto=0&height=66"></iframe>

<pre><code>2013的某一天
他认识了PHP
可他从不敢相信
那是噩梦的开启
2015的某一天
加班到无法休息
忙里偷闲打开微信
却没人发消息
2017的某一天
面试之前认真复习
上上知乎问问建议
当初就不该学PHP
他们说用Python的
看不起用Java的啊
Java的也只能骂PHP啦
就算你们都是用Python的呀
Python3和Python2也势不两立啊
用AS的看不起用Eclipse的啊
可苹果也看不起做Android的
Vim和Emacs吵个不停啦
还天天骂Sublime的智障吗
用React的看不起用Angular的
Git用户天天骂SVN傻瓜
Docker用户说
Puppet是上个世纪的吗
用图形界面不用命令
智商不够用吗
用Debian的瞧不起用Ubuntu的
用MBP的说用win没钱吗
BAT的说小公司也算公司吗
独角兽说我分十亿你分得起吗
黑轴茶轴天天纠缠不休啊
难怪双飞燕的妹子插不上话
坐Aeron的看不起坐办公椅的
站着打代码的说你俩会长胖的
985的看不起211的啊
他们还天天骂北大青鸟呢
考计算机二级是有病吗
Gayhub没有一千星星别来丢人啦
啊别再骂啦
女朋友呢 找到了吗
</code></pre><!-- 
        <div id="aplayer-ZNqFIEYq" class="aplayer aplayer-tag-marker" style="margin-bottom: 20px;">
            <pre class="aplayer-lrc-content"></pre>
        </div>
        <script>
          var ap = new APlayer({
            element: document.getElementById("aplayer-ZNqFIEYq"),
            narrow: false,
            autoplay: false,
            showlrc: false,
            music: {
              title: "她的睫毛",
              author: "周杰伦",
              url: "http://home.ustc.edu.cn/~mmmwhy/%d6%dc%bd%dc%c2%d7%20-%20%cb%fd%b5%c4%bd%de%c3%ab.mp3",
              pic: "http://home.ustc.edu.cn/~mmmwhy/jay.jpg",
              lrc: ""
            }
          });
          window.aplayers || (window.aplayers = []);
          window.aplayers.push(ap);
        </script> –&gt;-->
             
            <div class="post-button text-center">
              <a class="btn" href="/2018/12/12/PHP/当初就不该学PHP/#更多" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-date">
			<div class="post-month">12月</div>
			<div class="post-day">10</div>
	</div>
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/10/nginx/Nginx4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="YonJim">
      <meta itemprop="description" content="我不知道将去何方，但我已在路上。">
      <meta itemprop="image" content="/images/293854950580539874.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="YonJim">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/10/nginx/Nginx4/" itemprop="url">
                  Nginx（四）常见Nginx架构场景
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-12-10 12:27:11" itemprop="dateCreated datePublished" datetime="2018-12-10T12:27:11+08:00">2018-12-10</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Nginx/" itemprop="url" rel="index"><span itemprop="name">Nginx</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/12/10/nginx/Nginx4/" class="leancloud_visitors" data-flag-title="Nginx（四）常见Nginx架构场景">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="常见Nginx中间件架构"><a href="#常见Nginx中间件架构" class="headerlink" title="常见Nginx中间件架构"></a>常见Nginx中间件架构</h1><ul>
<li>静态资源web服务</li>
<li>代理服务</li>
<li>负载均衡调度器SLB</li>
<li>动态缓存</li>
</ul>
<h1 id="静态资源web服务-（优化配置之类的）"><a href="#静态资源web服务-（优化配置之类的）" class="headerlink" title="静态资源web服务 （优化配置之类的）"></a>静态资源web服务 （优化配置之类的）</h1><h2 id="ngx-http-core-module-模块的-Directive"><a href="#ngx-http-core-module-模块的-Directive" class="headerlink" title="ngx_http_core_module 模块的 Directive"></a><a href="http://nginx.org/en/docs/http/ngx_http_core_module.html" target="_blank" rel="noopener">ngx_http_core_module</a> 模块的 Directive</h2><ul>
<li><p>sendfile “零拷贝” <a href="http://nginx.org/en/docs/http/ngx_http_core_module.html" target="_blank" rel="noopener">ngx_http_core_module</a></p>
<blockquote>
<p>sendfile系统调用在两个文件描述符之间直接传递数据(完全在内核中操作)，从而避免了数据在内核缓冲区和用户缓冲区之间的拷贝，操作效率很高，被称之为零拷贝。</p>
</blockquote>
<p>  Syntax：sendfile on | off;<br>  Default：sendfile off;<br>  Context：http，server，location，if in location</p>
</li>
<li><p>tcp_nopush</p>
<blockquote>
<p>仅在使用sendfile时才启用这个选项。提高网络包的传输效率。</p>
</blockquote>
<p>  Syntax：sendfile on | off;<br>  Default：sendfile off;<br>  Context：http，server，location，if in location</p>
</li>
<li><p>tcp_nodelay</p>
<blockquote>
<p>keep-alive连接下，提高网络包的传输实时性。</p>
</blockquote>
<p>  Syntax: tcp_nodelay on | off;<br>  Default: tcp_nodelay on;<br>  Context: http, server, location</p>
</li>
</ul>
<h2 id="ngx-http-gzip-module-压缩模块的-Directive-（详细指令语法，参考官方文档）"><a href="#ngx-http-gzip-module-压缩模块的-Directive-（详细指令语法，参考官方文档）" class="headerlink" title="ngx_http_gzip_module 压缩模块的 Directive （详细指令语法，参考官方文档）"></a><a href="http://nginx.org/en/docs/http/ngx_http_gzip_module.html" target="_blank" rel="noopener">ngx_http_gzip_module</a> 压缩模块的 Directive （详细指令语法，参考官方文档）</h2><ul>
<li><p>gzip 压缩压缩</p>
<p>  Syntax: gzip on | off;<br>  Default: gzip off;<br>  Context: http, server, location, if in location</p>
</li>
<li><p>扩展Nginx压缩模块</p>
<ul>
<li>http_gzip_static_module - 预读gzip功能（访问预先压缩好的文件。）</li>
<li>http_gunzip_module - 应用支持gunzip的压缩方式（兼容不支持gzip的浏览器）</li>
</ul>
</li>
</ul>
<h2 id="浏览器缓存"><a href="#浏览器缓存" class="headerlink" title="浏览器缓存"></a>浏览器缓存</h2><table><tr><td>校验是否过期</td><td>Expires(HTTP1.0)、Cache-Control(HTTP1.1) <br> 没有过期直接在从缓存中读取，不会请求服务端，下面两个头信息会请求服务端判断是否修改了文件</td></tr><tr><td>协议中的Eta头信息校验</td><td>Etag</td></tr><tr><td>Last—Modified头信息校验</td><td>Last—Modified</td></tr></table>

<ul>
<li><p><a href="http://nginx.org/en/docs/http/ngx_http_headers_module.html" target="_blank" rel="noopener">ngx_http_headers_module</a> 模块允许将”Expires”和”Cache-Control”头字段和任意字段添加到响应头！！。</p>
<p>  Syntax: expires [modified] time;</p>
<pre><code>expires epoch | max | off;
</code></pre><p>  Default: expires off;<br>  Context: http, server, location, if in location</p>
</li>
</ul>
<h2 id="跨域访问-CORS-Access-Control-Allow-Origin"><a href="#跨域访问-CORS-Access-Control-Allow-Origin" class="headerlink" title="跨域访问 CORS (Access-Control-Allow-Origin)"></a>跨域访问 CORS (Access-Control-Allow-Origin)</h2><blockquote>
<p>注意 CSRF 攻击哦</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add_header Access-Control-Allow-Origin *;</span><br><span class="line">add_header Access-Control-Allow-Methods GET,POST,PUT;</span><br></pre></td></tr></table></figure>
<h2 id="防盗链"><a href="#防盗链" class="headerlink" title="防盗链"></a>防盗链</h2><blockquote>
<p>目的：防止资源被盗用</p>
</blockquote>
<h3 id="基于http-referer防盗链配置模块"><a href="#基于http-referer防盗链配置模块" class="headerlink" title="基于http_referer防盗链配置模块"></a>基于http_referer防盗链配置模块</h3><pre><code>valid_referers 指定将嵌入$invalid_referer变量设置为空字符串的&quot;Referer&quot;请求头字段值。否则，变量将设置为&quot;1&quot;(无效的话 变量设置为1，再去判断返回403)。搜索匹配不区分大小写。
Syntax: valid_referers none(可以为空) | blocked(可以不带协议信息) | server_names(服务器名称) | string ... | 正则(eg: ~/aaa/g);
Default: —
Context: server, location
</code></pre><h1 id="代理服务"><a href="#代理服务" class="headerlink" title="代理服务"></a>代理服务</h1><h2 id="ngx-http-proxy-module-proxy-proxy-proxy-列几个常用的指令配置，详细请看官网"><a href="#ngx-http-proxy-module-proxy-proxy-proxy-列几个常用的指令配置，详细请看官网" class="headerlink" title="ngx_http_proxy_module proxy proxy proxy (列几个常用的指令配置，详细请看官网)"></a><a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html" title="http_proxy" target="_blank" rel="noopener">ngx_http_proxy_module</a> proxy proxy proxy (列几个常用的指令配置，详细请看官网)</h2><blockquote>
<p><a href="#缓存服务（代理缓存）">缓存服务（代理缓存）</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">eg: location / &#123;</span><br><span class="line">        proxy_pass       http://localhost:8000;</span><br><span class="line">        proxy_set_header Host      <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>; <span class="comment"># 设置真实的IP请求头信息（X-Real-IP）</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>proxy_pass 代理地址</p>
<pre><code>Syntax: proxy_pass URL;
Default: —
Context: location, if in location, limit_except
</code></pre></li>
<li><p>proxy_set_header 设置（发给后端的）请求头信息</p>
<pre><code>Syntax: proxy_set_header field value;
Default: proxy_set_header Host $proxy_host;
Context: http, server, location
</code></pre></li>
<li><p>proxy_buffering 缓冲区 on | off</p>
</li>
<li><p>proxy_next_upstream 指定应将请求传递到下一个服务器</p>
<pre><code>Syntax: proxy_next_upstream error | timeout | invalid_header |
        http_500 | http_502 | http_503 | http_504 | http_403 | http_404 | http_429 | non_idempotent | off ...;
Default: proxy_next_upstream error timeout;
Context: http, server, location
</code></pre></li>
</ul>
<h1 id="负载均衡-SLB"><a href="#负载均衡-SLB" class="headerlink" title="负载均衡 SLB"></a>负载均衡 SLB</h1><blockquote>
<p>GSLB: Global Server Load Balance(全局负载均衡)<br>SLB: Server Load Balance(负载均衡)<br>四层（OSI第四层就是传输层）负载均衡，也就是主要通过报文中的目标地址（ip）和端口，再加上负载均衡设备设置的服务器选择方式，决定最终选择的内部服务器。<br>七层（OSI第七层就是应用层）负载均衡，也称为”内容交换”，也就是主要通过报文中的真正有意义的应用层内容，再加上负载均衡设备设置的服务器选择方式，决定最终选择的内部服务器。</p>
</blockquote>
<h2 id="Nginx配置-upstream-实现负载均衡-ngx-http-upstream-module"><a href="#Nginx配置-upstream-实现负载均衡-ngx-http-upstream-module" class="headerlink" title="Nginx配置 upstream 实现负载均衡 ngx_http_upstream_module"></a>Nginx配置 upstream 实现负载均衡 <a href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html" target="_blank" rel="noopener">ngx_http_upstream_module</a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server backend1.example.com       weight=5;</span><br><span class="line">    server backend2.example.com:8080;</span><br><span class="line">    server unix:/tmp/backend3;</span><br><span class="line"></span><br><span class="line">    server backup1.example.com:8080   backup;</span><br><span class="line">    server backup2.example.com:8080   backup;</span><br><span class="line">    # server 参数设置</span><br><span class="line">    # weight 设置服务器的权重（加权轮询），默认为1 （默认是轮询） 两个都不好，如果在有缓存的情况下用户每次都会访问到不一致的内容。（解决方法看下面的 hash）</span><br><span class="line">    # down   当前的server展示不参与SLB</span><br><span class="line">    # backup 预留的备份服务器</span><br><span class="line">    # max_fails 允许请求失败的次数</span><br><span class="line">    # fail_timeout 经过max_fail失败后，服务暂停的时间（等待响应时间）</span><br><span class="line">    # max_conns 限制最大的接受的连接数（根据服务器配置按需设置）默认值为零，表示没有限制</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://backend;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>upstream</p>
<pre><code>Syntax: upstream name { ... }
Default: —
Context: http
</code></pre></li>
<li><p>hash 指定服务器组的负载平衡方法，其中client-server映射基于散列key值。推荐使用这种方式</p>
<pre><code>Syntax: hash key [consistent];
Default: —
Context: upstream
</code></pre></li>
<li><p>ip_hash  每个请求按访问IP的hash结果分配，这样来自同一个IP的固定访问一个后端服务器</p>
<blockquote>
<p>缺点：客户端请求将被传递到另一个服务器。最有可能的是，它也将始终是同一台服务器，而非真实的IP。</p>
</blockquote>
<pre><code>Syntax: ip_hash;
Default: —
Context: upstream
</code></pre></li>
</ul>
<h1 id="缓存服务（代理缓存）"><a href="#缓存服务（代理缓存）" class="headerlink" title="缓存服务（代理缓存）"></a>缓存服务（代理缓存）</h1><blockquote>
<p>客户端缓存 代理缓存 服务端缓存（redis memcached）</p>
</blockquote>
<h2 id="Nginx代理缓存配置语法"><a href="#Nginx代理缓存配置语法" class="headerlink" title="Nginx代理缓存配置语法"></a><a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_cache_path" title="proxy_cache_path" target="_blank" rel="noopener">Nginx代理缓存配置语法</a></h2><h3 id="proxy-cache-path-设置缓存的路径和其他参数。"><a href="#proxy-cache-path-设置缓存的路径和其他参数。" class="headerlink" title="proxy_cache_path 设置缓存的路径和其他参数。"></a>proxy_cache_path 设置缓存的路径和其他参数。</h3><pre><code>Syntax: proxy_cache_path path [levels=levels] [use_temp_path=on|off] keys_zone=name:size [inactive=time]
        [max_size=size] [manager_files=number] [manager_sleep=time] [manager_threshold=time]
        [loader_files=number] [loader_sleep=time] [loader_threshold=time] [purger=on|off]
        [purger_files=number] [purger_sleep=time] [purger_threshold=time];
Default: —
Context: http

# 上面部分参数的作用
# path 代理缓存存储路径
# levels 目录层次结构级别 eg: levels=1:2
# keys_zone 所有的活性密钥和关于数据的信息被存储在共享存储器区，其name与size设置，配置keys_zone的参数。1M字节zone可以存储大约8000个密钥。
  在proxy_cache配置会用到zone的name。eg: keys_zone=one:10m;
# inactive 指定的时间内未访问的缓存数据 将从缓存中删除，无论其新鲜度如何。默认情况下，inactive设置为10分钟。
# max_size 设置的最大缓存大小。超过此大小时，它会删除最近最少使用的数据。
# use_temp_path 临时文件的目录 eg: use_temp_path=off 命令指示NGINX将在缓存这些文件时将它们写入同一个目录下。(并不是关闭临时文件存储)
</code></pre><h3 id="proxy-cache-定义用于缓存的共享内存区域。"><a href="#proxy-cache-定义用于缓存的共享内存区域。" class="headerlink" title="proxy_cache 定义用于缓存的共享内存区域。"></a>proxy_cache 定义用于缓存的共享内存区域。</h3><pre><code>Syntax: proxy_cache zone | off;
Default: proxy_cache off;
Context: http, server, location
</code></pre><h3 id="proxy-cache-valid-设置不同响应状态码的缓存时间。"><a href="#proxy-cache-valid-设置不同响应状态码的缓存时间。" class="headerlink" title="proxy_cache_valid  设置不同响应状态码的缓存时间。"></a>proxy_cache_valid  设置不同响应状态码的缓存时间。</h3><pre><code>eg: proxy_cache_valid 200 302 10m;
    proxy_cache_valid 404      1m;
    proxy_cache_valid any 1h;       # any 指定缓存任何响应
    proxy_cache_valid 5m;           # 只缓存200,301和302的响应。

Syntax: proxy_cache_valid [code ...] time;
Default: —
Context: http, server, location
</code></pre><h3 id="proxy-no-cache-定义不将响应保存到缓存的条件。"><a href="#proxy-no-cache-定义不将响应保存到缓存的条件。" class="headerlink" title="proxy_no_cache 定义不将响应保存到缓存的条件。"></a>proxy_no_cache 定义不将响应保存到缓存的条件。</h3><blockquote>
<p>如果字符串参数的至少一个值不为空且不等于”0”，则不会保存响应</p>
</blockquote>
<pre><code>Syntax: proxy_no_cache string ...;
Default: —
Context: http, server, location
</code></pre><h3 id="清理指定代理缓存"><a href="#清理指定代理缓存" class="headerlink" title="清理指定代理缓存"></a>清理指定代理缓存</h3><ol>
<li>rm -rf 删除缓存目录内容</li>
<li>使用第三方扩展模块ngx_cache_purge</li>
</ol>
<h3 id="大文件分片请求"><a href="#大文件分片请求" class="headerlink" title="大文件分片请求"></a>大文件分片请求</h3>
             
            <div class="post-button text-center">
              <a class="btn" href="/2018/12/10/nginx/Nginx4/#更多" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/18/">18</a><a class="extend next" rel="next" href="/page/13/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/293854950580539874.jpg" alt="YonJim">
            
              <p class="site-author-name" itemprop="name">YonJim</p>
              <p class="site-description motion-element" itemprop="description">我不知道将去何方，但我已在路上。</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">35</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

   

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">

<p>博客已运行<span id="since"></span><span class="my-face">(●'◡'●)ﾉ♥</span></p>
 &copy; 2018 – <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">YonJim</span>

  

  
</div>










  <div class="footer-custom">233</div>


        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        
        
      </div>
    

    

    

    
  </div>
  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  















  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.2"></script>



  
  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.2"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.2"></script>



  



  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script>
    
    function showTime(Counter) {
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      Counter('get', '/classes/Counter', { where: JSON.stringify({ url: { "$in": entries } }) })
        .done(function ({ results }) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function ({ responseJSON }) {
          console.log("LeanCloud Counter Error: " + responseJSON.code + " " + responseJSON.error);
        });
    }
    

    $(function() {
      $.get('https://app-router.leancloud.cn/2/route?appId=' + "XJstlxu9Bl1nBTWf7xYfQC3T-gzGzoHsz")
        .done(function ({ api_server }) {
          var Counter = function (method, url, data) {
            return $.ajax({
              method: method,
              url: `https://${api_server}/1.1${url}`,
              headers: {
                'X-LC-Id': "XJstlxu9Bl1nBTWf7xYfQC3T-gzGzoHsz",
                'X-LC-Key': "H3sbSEWC6SmxN4EHQx9d2140",
                'Content-Type': 'application/json',
              },
              data: data,
            });
          };
          
          if ($('.post-title-link').length >= 1) {
            showTime(Counter);
          }
          
        })
    });
  </script>



  

  

  

  

  
  

  

  

  

  

  


  
  <canvas id="evanyou"></canvas>

  <script type="text/javascript" src="/js/all.min.js?v="></script>

</body>
</html>
